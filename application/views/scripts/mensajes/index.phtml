 
<br><h1>MENSAJES</h1><br>
  
 <?php 
	 $aut = Zend_Auth::getInstance();
 
	 if($this->mensaje_ok == "ok")
	 {
	 	echo "<div id='divMensaje'><div class='alert alert-success'><button class='close' data-dismiss='alert'>×</button>Mensaje enviado exitosamente</div></div>";
	 }
 
	 if($this->mensaje_ok == "error")
	 {
	 	echo "<div id='divMensajeError'><div class='alert alert-success'><button class='close' data-dismiss='alert'>×</button>El usuario destinatario del mensaje no existe</div></div>";
	 }
	 
 ?>
 
 <?php if($this->mensaje_ok == "ok"){
 		echo "<div id='divMensajeDejarParticipar'><div class='alert alert-success'><button class='close' data-dismiss='alert'>×</button>Mensaje enviado exitosamente</div></div>";
 }?>
 
<div class="tabbable span9 well">
    <ul class="nav nav-tabs">
    	<li><a href="#misMensajes" data-toggle="tab">Mis Mensajes</a></li>
    </ul>
    <div class="tab-content">
    	<div class="tab-pane active" id="misMensajes">
    	<table>
    	<?php
    		foreach ($this->listaUsuarios as $item)
		    {
		?>
			<tr id="rowUno<?php echo $item->getId();?>" style="display: block;">
				<td colspan=2>
					<?php echo $item->getNombre();?>
				</td>			
			</tr>
			<tr id="rowDos<?php echo $item->getId();?>" style="display: block;">
				<td>
					<div style='width: 80px;'>
						<a class='thumbnail'>
							<img src="/imagenes/usuarios/<?php echo $item->getFoto();?>" >
						</a>
					</div>
				</td>
			<td>
				<?php 
					$objMensajeDao = new Application_Model_MensajeDao();
					$cantMensajes = $objMensajeDao->contarMensajes($aut->getIdentity()->usu_id, $item->getId());
					
					if ($cantMensajes % 10 == 0)
					{
					    $pagina = $cantMensajes/10;
					}
					else
					{
					    $pagina = floor($cantMensajes/10)+1;
					}
				?>
			
			
				<a class="btn btn-info" href="<?php echo $this->url(array('controller'=>'mensajes', 'action'=>'ver', 'id'=>$item->getId(),'page'=>$pagina)); ?>"> Ver mensaje </a>
			</td>	
    	<?php }?>
    	</table>
    	</div>
    </div>
</div>
 
 <div class="modal hide" id="myModalNuevoMensaje" style="width: 700px;">
    <div class="modal-header">
    	<button class="close" onclick="closeModalNuevoMensaje()" data-dismiss="modal">×</button>
    <h2><img src="/imagenes/proyecto/add.png">&nbsp;&nbsp;&nbsp;Nuevo Mensaje</h2>
    </div>
    <div class="modal-body">
 		<form action="/mensajes/index/" method="post" enctype="<?php echo $this->form->getEnctype(); ?>">
			<div class="Para">
				<div class="ui-widget">
					<?php echo $this->form->txtPara; ?>
				</div>
			</div>
			<?php
				echo $this->form->txtTextoMensaje;	
				echo $this->form->enviar;
             ?>
        </form>
    </div>
</div>
 
 <script type="text/javascript">
	function openModalNuevoMensaje()
	{
		$('#myModalNuevoMensaje').modal("show");	
	}

	function closeModalNuevoMensaje()
	{
		$('#myModalNuevoMensaje').modal();	
	}

	$(function() {
		<?php 
			$aut = Zend_Auth::getInstance();
			$objAmigoDao = new Application_Model_AmigoDao();
			$listaUsuarios = $objAmigoDao->obtenerTodosPorNombre($aut->getIdentity()->usu_id);
		?>
		$( "#txtPara" ).autocomplete({
			source: <?php echo json_encode($listaUsuarios); ?>
		});
	});

	
 
 </script>